tinymce.PluginManager.add("uploadfile",function(j,a){var k="上传文件";window.upfile={};var b=tinymce.baseURL||".";var p=j.getParam("attachment_assets_path")||a+"/icons";var f=a+"/uploadFiles.html";upfile.file_callback=j.getParam("file_callback",undefined,"function");upfile.tinymce=tinymce;upfile.res=[];var e=function(r){var u=r.lastIndexOf(".");if(u===-1){return"default_file.svg"}for(var w=r.substr(u+1).toLowerCase(),s=0,v=[{ext:"txt",icon:"file_type_text"},{ext:"doc",icon:"file_type_word2"},{ext:"docx",icon:"file_type_word2"},{ext:"pdf",icon:"file_type_pdf2"},{ext:"xls",icon:"file_type_excel2"},{ext:"xlsx",icon:"file_type_excel2"},{ext:"ppt",icon:"file_type_powerpoint2"},{ext:"pptx",icon:"file_type_powerpoint2"},{ext:"ai",icon:"file_type_ai2"},{ext:"psd",icon:"file_type_photoshop2"},{ext:"zip",icon:"file_type_zip"},{ext:"rar",icon:"file_type_zip"},{ext:"jpg",icon:"file_type_image"},{ext:"jpeg",icon:"file_type_image"},{ext:"png",icon:"file_type_image"},{ext:"gif",icon:"file_type_image"},{ext:"js",icon:"file_type_js"},{ext:"xml",icon:"file_type_xml"},{ext:"htm",icon:"file_type_html"},{ext:"html",icon:"file_type_html"},{ext:"json",icon:"file_type_light_json"},{ext:"fon",icon:"file_type_light_font"},{ext:"font",icon:"file_type_light_font"},{ext:"svg",icon:"file_type_image"},{ext:"exe",icon:"file_type_binary"},{ext:"bin",icon:"file_type_binary"},{ext:"dll",icon:"file_type_binary"},{ext:"pkg",icon:"file_type_package"},{ext:"wav",icon:"file_type_audio"},{ext:"mp3",icon:"file_type_audio"},{ext:"mp4",icon:"file_type_video"},{ext:"mov",icon:"file_type_video"},{ext:"avi",icon:"file_type_video"},{ext:"java",icon:"file_type_java"},{ext:"cs",icon:"file_type_csharp"},{ext:"css",icon:"file_type_css"},{ext:"py",icon:"file_type_python"},{ext:"sln",icon:"file_type_vscode3"},{ext:"go",icon:"file_type_go"},{ext:"7z",icon:"file_type_zip"},{ext:"sketch",icon:"file_type_sketch"},{ext:"patch",icon:"file_type_patch"},{ext:"org",icon:"file_type_org"},{ext:"md",icon:"file_type_markdown"},{ext:"jar",icon:"file_type_jar"},{ext:"dmg",icon:"file_type_dmg"},{ext:"accdb",icon:"file_type_access"},{ext:"apk",icon:"file_type_apk"},{ext:"eps",icon:"file_type_eps"},{ext:"ico",icon:"file_type_ico"},{ext:"iso",icon:"file_type_iso"},{ext:"key",icon:"file_type_keynote"},{ext:"numbers",icon:"file_type_number"},{ext:"reg",icon:"file_type_reg"},{ext:"rp",icon:"file_type_rp"},{ext:"rtf",icon:"file_type_rtf"},{ext:"sketch",icon:"file_type_sketch"},{ext:"swf",icon:"file_type_swf"},{ext:"url",icon:"file_type_url"},{ext:"wma",icon:"file_type_wma"},{ext:"xmind",icon:"file_type_xmind"},{ext:"cat",icon:"file_type_cat"}];s<v.length;s++){var q=v[s];if(q.ext===w){return q.icon+".svg"}}return"default_file.svg"};var d=function(){return j.windowManager.openUrl({title:k,size:"large",width:800,height:450,url:f,buttons:[{type:"cancel",text:"Close"},{type:"custom",text:"Save",name:"save",primary:true}],onAction:function(s,r){switch(r.name){case"save":var q=upfile.res;m(q);upfile.res=[];s.close();break;default:break}}})};var m=function(q){if(q&&q.length>0){var r='<span class="attachments" contenteditable="false">';for(let i=0;i<q.length;i++){r+='<span  class="attachment" contenteditable="false" style="display:inline-block;padding: 5px 10px"><img src="'+p+"/"+e(q[i].filename)+'" width="30px"><a href="'+q[i].url+'" target="_blank" title="'+q[i].text+'" >'+q[i].text+"("+h(q[i].size)+")</a></span><br>"}r+="</span>";j.insertContent(r)}};var h=function(s,q){if(void 0===q&&(q=2),0===s){return"0 B"}var t=q<0?0:q,r=Math.floor(Math.log(s)/Math.log(1024));return parseFloat((s/Math.pow(1024,r)).toFixed(t))+" "+["B","K","M","G","T","P","E","Z","Y"][r]};j.on("drop",function(v){j.notificationManager.close();v.stopPropagation();v.preventDefault();if(!v.dataTransfer.files){return false}var q=[];var s=v.dataTransfer.files.length;if(v.dataTransfer.items!==undefined){for(var u=0;u<v.dataTransfer.items.length;u++){var z=v.dataTransfer.items[u];if(z.kind==="file"&&z.webkitGetAsEntry().isFile){var r=z.getAsFile();q.push(r)}else{j.notificationManager.open({text:"不支持文件夹上传",type:"error"});console.log("不支持文件夹上传")}}}else{for(var u=0;u<s;u++){var y=v.dataTransfer.files[u];if(y.type){q.push(y)}else{try{var t=new FileReader();t.readAsDataURL(y.slice(0,3));t.addEventListener("load",function(A){console.log(A,"load");q.push(y)},false);t.addEventListener("error",function(A){j.notificationManager.open({text:"不支持文件夹上传",type:"error"});console.log("不支持文件夹上传")},false)}catch(v){j.notificationManager.open({text:"不支持文件夹上传",type:"error"});console.log("不支持文件夹上传")}}}}if(!(q.length>0)){return false}var x=[];var w=[];for(let u=0;u<q.length;u++){if(c(q[u].name)){x.push(q[u])}else{w.push(q[u])}}g(w)});function g(q){if(q===undefined||q.length===0){return false}for(let n=0;n<q.length;n++){q[n].uuid=l();q[n].isUpload=false}o(q);for(let i=0;i<q.length;i++){upfile.file_callback(q[i],function(t,u){q[i].isUpload=true;var r=j.dom.select("#file-percent-"+q[i].uuid);var s=j.dom.select("#attachment-"+q[i].uuid);j.dom.setHTML(r,"("+100+"%)");j.dom.setHTML(s,'<img src="'+p+"/"+e(q[i].name)+'" width="30px"><a href="'+t+'" target="_blank" title="'+u+'" >'+u+"("+h(q[i].size)+")</a>")},function(s){if(s>=100){s=99}if(q[i].isUpload){s=100}var r=j.dom.select("#file-percent-"+q[i].uuid);j.dom.setHTML(r,"("+s+"%)")})}}function c(q){let imgExt=["jpeg","jpg","png","gif","tif","tga","bmp","svg","eps","exif","pcx","fpx"];var r=q.lastIndexOf(".");if(r===-1){return false}var s=q.substr(r+1).toLowerCase();if(imgExt.indexOf(s)!==-1){return true}return false}function o(q){if(q&&q.length>0){var r='<span class="attachments" contenteditable="false">';for(let i=0;i<q.length;i++){r+='<span  class="attachment" contenteditable="false" id="attachment-'+q[i].uuid+'" style="display:inline-block;padding: 5px 10px"><img src="'+p+'/loading.gif" width="30px"><span  id="file-url-'+q[i].uuid+'"  title="'+q[i].name+'" >'+q[i].name+"<span id='file-percent-"+q[i].uuid+"'>(0.00%)</span></span></span><br>"}r+="</span>";j.insertContent(r)}}function l(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var s=Math.random()*16|0,q=t==="x"?s:(s&3|8);return q.toString(16)})}j.ui.registry.getAll().icons.upfile||j.ui.registry.addIcon("uploadfile",'<svg t="1616034901576" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1315" width="26" height="26"><path d="M842.512 240.352v-0.192a27.68 27.68 0 0 0-0.176-1.744l-0.032-0.24a27.584 27.584 0 0 0-5.184-12.816l-0.368-0.48a27.936 27.936 0 0 0-1.328-1.6l-0.56-0.592-0.608-0.64-152.48-149.776a27.68 27.68 0 0 0-16.48-8.08h-0.064a27.52 27.52 0 0 0-1.888-0.16h-0.432L662.032 64H203.776C188.432 64 176 76.432 176 91.792v833.76c0 15.36 12.432 27.792 27.776 27.792h611.008c15.344 0 27.776-12.432 27.776-27.792v-683.68a28.64 28.64 0 0 0-0.048-1.52z m-152.704-82.304l57.04 56.032h-57.04V158.048z m97.2 739.712H231.52V119.584h402.72v122.304c0 15.36 12.448 27.792 27.776 27.792h124.96V897.76z m-78.304-384.368H323.84c-15.36 0-27.776 12.432-27.776 27.792 0 15.36 12.432 27.792 27.776 27.792h384.88a27.792 27.792 0 0 0 0-55.584z m-412.656-88.944c0 15.36 12.432 27.808 27.776 27.808h384.88a27.792 27.792 0 0 0 0-55.6H323.84c-15.36 0-27.776 12.432-27.776 27.792z m412.656 205.648H323.84c-15.36 0-27.776 12.432-27.776 27.792 0 15.36 12.432 27.792 27.776 27.792h384.88a27.792 27.792 0 0 0 0-55.584z m0 116.736H323.84a27.776 27.776 0 1 0 0 55.584h384.88a27.792 27.792 0 0 0 0-55.584z" p-id="1316"></path></svg>');j.ui.registry.addButton("uploadfile",{icon:"uploadfile",tooltip:k,onAction:function(){d()}});j.ui.registry.addMenuItem("uploadfile",{icon:"uploadfile",text:"文件上传...",onAction:function(){d()}});return{getMetadata:function(){return{name:k,url:"https://github.com/Five-great/tinymce-plugins"}}}});