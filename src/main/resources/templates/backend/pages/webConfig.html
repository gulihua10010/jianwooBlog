<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>网站配置</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0"
          name="viewport">
    <link href="/static/plugins/layuiadmin/layui/css/layui.css" media="all" rel="stylesheet">
    <link href="/static/plugins/layuiadmin/style/admin.css" media="all" rel="stylesheet">
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">网站配置</div>
                <div class="layui-card-body">
                    <div class="layui-form" id="layuiadmin-form-comment" lay-filter="layuiadmin-form-comment"
                         style="padding: 20px 30px 0 0;">
                        <div class="layui-card-body">
                            <div class="layui-form-item">
                                <label class="layui-form-label">站点标题</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" name="title" lay-verify="required|maxLength" lay-max="50"
                                           th:value="${webConf.title}" type="text">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">网站作者</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" name="author" lay-verify="maxLength" lay-max="20"
                                           th:value="${webConf.author}" type="text">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">网站关键字</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" name="keywords" lay-verify="maxLength" lay-max="50"
                                           th:value="${webConf.keywords}"
                                           type="text">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">网站描述</label>
                                <div class="layui-input-block">
                <textarea class="layui-textarea" name="description" th:text="${webConf.description}" lay-max="500"
                          lay-verify="maxLength" type="text">
                </textarea>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">网站备案</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" name="record" th:value="${webConf.record}" lay-max="500"
                                           lay-verify="maxLength" type="text">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">网站域名</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" name="domain" th:value="${webConf.domain}" lay-max="50"
                                           lay-verify="maxLength" type="text">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">网站底部信息(支持html)</label>
                                <div class="layui-input-block">
                <textarea class="layui-textarea" name="footInfo" th:text="${webConf.footHtml}" lay-verify="maxLength"
                          lay-max="500" type="text">
                </textarea>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">上传logo</label>
                                <div class="layui-input-block">
                                    <button class="layui-btn" id="uploadLogo" type="button">上传图片</button>
                                    <div class="layui-upload-list imgupload">
                                        <img class="layui-upload-img" id="logoimg"
                                             style="margin-left: 5px" th:src="${webConf.logoImg}"
                                             width="100">
                                        <p id="logoimgText"></p>
                                        <input id="logoImgSrc" name="logoImgSrc" style="visibility: hidden"
                                               th:value="${webConf.logoImg}">
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">首页顶部图片:（建议9：1图片）</label>
                                <div class="layui-input-block">
                                    <button class="layui-btn" id="uploadHomeImg" type="button">上传图片</button>
                                    <div class="layui-upload-list imgupload">
                                        <img class="layui-upload-img" id="homeImg"
                                             style="margin-left: 5px" th:src="${webConf.homeImg}"
                                             width="500">
                                        <p id="homeImgText"></p>
                                        <input id="homeImgSrc" name="homeImgSrc" style="visibility: hidden"
                                               th:value="${webConf.homeImg}">
                                    </div>
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <label class="layui-form-label">每页显示文章数</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" name="numPerPage" th:value="${webConf.numPerPage}"
                                           lay-verify="number"
                                           type="text">
                                </div>
                            </div>

                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <input id="isComment" name="isComment" th:checked="${webConf.isComment}"
                                           title="开启评论"
                                           type="checkbox" value="1">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label"></label>
                                <div class="layui-input-inline">
                                    <input class="layui-btn" id="submit" lay-filter="submit" lay-submit
                                           type="button" value="确认">
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
</div>

<script src="/static/plugins/layuiadmin/layui/layui.js"></script>
<script src="/static/js/common.js" type="text/javascript"></script>
<script>
    layui.config({
        base: '/static/plugins/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'form', 'table', "upload"], function () {
        var index;
        var $ = layui.$
            , form = layui.form
            , $ = layui.$
            , upload = layui.upload;


        layui.form.on('submit', function (formData) {
            var field = formData.field; //获取提交的字段
            ajaxPost(
                '/api/admin/webconf/update',
                JSON.stringify({
                    title: field.title,
                    author: field.author,
                    keywords: field.keywords,
                    description: field.description,
                    record: field.record,
                    domain: field.domain,
                    footHtml: field.footInfo,
                    logoImg: field.logoImgSrc,
                    homeImg: field.homeImgSrc,
                    numPerPage: field.numPerPage,
                    isComment: field.isComment == 1 ? 1 : 0
                }),
                "更新成功",
                function () {
                    location.reload()
                }
            );

        });
        var uploadLogo = upload.render({
            elem: '#uploadLogo'
            , url: '/api/file/upload'
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#logoimg').attr('src', result); //图片链接（base64）
                });
                index = layer.load(0, {shade: false, offset: '400px'}, {time: 3000});
            }
            , done: function (res) {
                layer.close(index);
                $('result').text(res.status);
                if (res.status) {
                    layer.msg('上传成功', {
                        title: '提示'
                        //不自动关闭
                        , time: 1000
                        , icon: 6
                        , offset: '400px'
                    });
                    $('#logoImgSrc').val(res.file.url);
                }
                //上传成功
            }
            , error: function () {
                layer.close(index);
                layer.msg('上传出错：1', {
                    title: '提示'
                    //不自动关闭
                    , time: 1000
                    , icon: 5
                    , offset: '400px'
                });
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadLogo.upload();
                });
            }
        });


        var uploadHomeImg = upload.render({
            elem: '#uploadHomeImg'
            , url: '/api/file/upload'
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#homeImg').attr('src', result); //图片链接（base64）
                });
                index = layer.load(0, {shade: false, offset: '400px'}, {time: 3000});
            }
            , done: function (res) {
                layer.close(index);
                $('result').text(res.status);
                if (res.status) {
                    layer.msg('上传成功', {
                        title: '提示'
                        //不自动关闭
                        , time: 1000
                        , icon: 6
                        , offset: '400px'
                    });
                    $('#homeImgSrc').val(res.file.url);
                }
                //上传成功
            }
            , error: function () {
                layer.close(index);
                layer.msg('上传出错：1', {
                    title: '提示'
                    //不自动关闭
                    , time: 1000
                    , icon: 5
                    , offset: '400px'
                });
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadHomeImg.upload();
                });
            }
        });


    });
</script>
</body>
</html>