<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="/static/plugins/layuiadmin/layui/css/layui.css" media="all" rel="stylesheet">
    <link href="/static/plugins/layuiadmin/style/admin.css" media="all" rel="stylesheet">
    <link href="/static/css/admin.css" media="all" rel="stylesheet">
    <title>控制台</title>
</head>
<body>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">快速概览</div>
                        <div class="layui-card-body">
                            <div class="layui-carousel layadmin-carousel layadmin-shortcut">
                                <ul class="layui-row layui-col-space10">
                                    <li class="layui-col-xs3">
                                        <a href="/admin/my/article?mode=PUBLISHED">
                                            <i class="iconfont">&#xe633;</i>
                                            <cite>已发布[[${publishedArtsCount}]]篇文章</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a href="/admin/my/article?mode=DRAFT">
                                            <i class="iconfont">&#xe674;</i>
                                            <cite>[[${draftArtsCount}]]篇草稿</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a href="/admin/comment/management">
                                            <i class="iconfont">&#xe535;</i>
                                            <cite>[[${commentCount}]]条评论</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a href="/admin/article/tags">
                                            <i class="iconfont">&#xe6b1;</i>
                                            <cite>[[${tagsCount}]]个标签</cite>
                                        </a>
                                    </li>

                                </ul>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">快速草稿</div>
                        <div class="layui-card-body">
                            <div class="layui-carousel layadmin-carousel layadmin-backlog">

                                <div class="layui-form" id="layuiadmin-form-comment"
                                     lay-filter="layuiadmin-form-comment"
                                     style="padding: 20px 30px 0 0;">
                                    <div class="layui-card-body">
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">标题</label>
                                            <div class="layui-input-block">
                                                <input class="layui-input" lay-verify="required|maxLength" lay-max="50"
                                                       name="title" type="text">
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">作者</label>
                                            <div class="layui-input-block">
                                                <input class="layui-input" name="author" lay-verify="required|maxLength"
                                                       lay-max="10"
                                                       type="text">
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label">草稿内容</label>
                                            <div class="layui-input-block">
                                                <textarea class="layui-textarea" name="content" lay-verify="required"
                                                          type="text"></textarea>
                                            </div>
                                        </div>
                                        <div class="layui-form-item">
                                            <label class="layui-form-label"></label>
                                            <div class="layui-input-inline">
                                                <input class="layui-btn" id="submit" lay-filter="submit" lay-submit
                                                       type="button" value="保存">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-tab layui-tab-brief layadmin-latestData">
                            <ul class="layui-tab-title">
                                <li class="layui-this">最近发布</li>
                                <li>最近草稿</li>
                            </ul>
                            <div class="layui-tab-content">
                                <div class="layui-tab-item layui-show">
                                    <table id="published-table" lay-filter="published-data"></table>
                                </div>
                                <div class="layui-tab-item">
                                    <table id="draft-table" lay-filter="draft-data"></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md6">
                    <div class="layui-card">
                        <div class="layui-card-header">最近评论</div>
                        <div class="layui-card-body">
                            <table id="comment-table" lay-filter="comment-data"></table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<!--<div class="clear"></div>-->
<div class="clear"></div>
</div>
<script src="/static/plugins/layuiadmin/layui/layui.js"></script>
<script src="/static/js/common.js" type="text/javascript"></script>
<script th:inline="none">
    layui.config({
        base: '/static/plugins/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'console', 'table'], function () {
        var admin = layui.admin
            , table = layui.table
            , $ = layui.$
            , form = layui.form;
        table.render({
            elem: '#published-table'
            , url: "/api/admin/console/recent/article/published/query"
            , cols: [[
                {field: 'desc', title: '文章概览', align: 'center'}

            ]]
            , page: false
            , text: {none: '无数据'}

        });
        table.render({
            elem: '#draft-table'
            , url: "/api/admin/console/recent/article/draft/query"
            , cols: [[
                {field: 'desc', title: '文章概览', align: 'center'}

            ]]
            , page: false
            , text: {none: '无数据'}

        });
        table.render({
            elem: '#comment-table'
            , url: "/api/admin/console/recent/comment/query"
            , cols: [[
                {field: 'desc', title: '评论概览', align: 'center'}

            ]]
            , page: false
            , text: {none: '无数据'}

        });

        var token;
        ajaxApiPost(
            "/api/admin/token/generate",
            JSON.stringify({
                pageId: 'A11',
            }),
            function (res) {
                token = res.token;
            }
        );

        layui.form.on('submit', function (formData) {
            var field = formData.field; //获取提交的字段
            var title = field.title;
            var author = field.author;
            var articleContent = field.content;
            if ($.trim(title) == '' || $.trim(author) == '' || $.trim(articleContent) == '') {
                alert_fail('提示', '标题、作者或内容不能为空！');
                return false;
            }
            ajaxPost(
                '/api/admin/article/save/draft',
                JSON.stringify({
                    title: title,
                    author: author,
                    articleContent: articleContent,
                    subToken: token
                }),
                "保存成功",
                function () {
                    location.reload()
                }
            );

        });

    });
</script>
</body>
</html>